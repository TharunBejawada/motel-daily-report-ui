import{m as L,z as A,u as B,r as m,n as M,p as S,f as U,c as D,a as l,b as v,A as F,t as y,s as n,q as f,v as x,y as b,w as _,o as C,_ as I,d as w}from"./CWpK9PPU.js";import{_ as O}from"./BV1nIDRG.js";const T={class:"space-y-4"},j={class:"flex items-center justify-between"},q={class:"text-2xl font-semibold"},z={key:0,class:"text-gray-500"},E={class:"flex items-center gap-2"},J=L({__name:"[id]",setup(P){const V=A(),g=B(),h=Number(V.params.id),c=m(null),d=m([]),s=m(""),u=m(""),i=m(""),N=[{key:"id",label:"ID"},{key:"report_date",label:"Report Date"},{key:"department",label:"Department"},{key:"auditor",label:"Auditor"},{key:"revenue",label:"Revenue"},{key:"occupancy",label:"Occupancy"},{key:"property_name",label:"Property"}],R=M(()=>{const o=s.value.trim().toLowerCase();return o?d.value.filter(t=>{var a,r;return((a=t.department)==null?void 0:a.toLowerCase().includes(o))||((r=t.auditor)==null?void 0:r.toLowerCase().includes(o))}):d.value});function $(o){try{return o?new Date(o).toLocaleDateString():"—"}catch{return o||"—"}}async function k(){var o,t;try{const a=await g.get(`/reports?motel_id=${h}`);c.value=a.data;const r={motel_id:h,page:1,limit:200};u.value&&(r.start_date=u.value),i.value&&(r.end_date=i.value),s.value&&(r.department=s.value);const{data:p}=await g.get("/reports",{params:r});d.value=((p==null?void 0:p.items)??[]).map(e=>({...e,property_name:`${e.motel_name??""} — ${e.location??""}`.trim()})),d.value.length>0&&(c.value={motel_name:d.value[0].motel_name,location:d.value[0].location})}catch(a){console.error(a),alert(((t=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:t.detail)||"Failed to load reports")}}return S(k),U([s,u,i],()=>{},{deep:!0}),(o,t)=>{var r,p;const a=I;return C(),D("div",T,[l("div",j,[l("h1",q," Reports — "+y(((r=n(c))==null?void 0:r.motel_name)||"Motel"),1),(p=n(c))!=null&&p.location?(C(),D("div",z,"📍 "+y(n(c).location),1)):F("",!0)]),l("div",E,[f(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>b(s)?s.value=e:null),class:"w-72 rounded-md border px-3 py-2 text-sm",placeholder:"Search department / auditor…"},null,512),[[x,n(s)]]),f(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>b(u)?u.value=e:null),type:"date",class:"rounded-md border px-3 py-2 text-sm"},null,512),[[x,n(u)]]),f(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>b(i)?i.value=e:null),type:"date",class:"rounded-md border px-3 py-2 text-sm"},null,512),[[x,n(i)]]),l("button",{class:"rounded-md border px-3 py-2 text-sm hover:bg-gray-50",onClick:k},"Filter")]),v(O,{headers:N,rows:n(R)},{"cell:report_date":_(({row:e})=>[w(y($(e.report_date)),1)]),"cell:property_name":_(({row:e})=>[v(a,{to:`/reports/${e.id}`,class:"text-blue-600 hover:underline"},{default:_(()=>[w(y(e.property_name),1)]),_:2},1032,["to"])]),actions:_(({row:e})=>[v(a,{to:`/reports/${e.id}`,class:"rounded-md border px-2 py-1 text-sm hover:bg-gray-50"},{default:_(()=>[...t[3]||(t[3]=[w("Open",-1)])]),_:1},8,["to"])]),_:1},8,["rows"])])}}});export{J as default};
